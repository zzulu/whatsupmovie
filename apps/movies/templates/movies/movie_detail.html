{% extends 'base.html' %}

{% block container %}

<h1>Movie Detail</h1>

<p>
  <a href="{% url 'movies:list' %}">List</a>
</p>

<img src="{{ movie.image_url }}" alt="Movie Image">
<h3>{{ movie.title }}</h3>
<p>{{ movie.content }}</p>
<p><b>Average Score : </b>{{ movie.get_avg_rating }}</p>

{% if user.is_authenticated %}

  {% if not rating_exists %}

    <form action="{% url 'movies:ratings_create' movie.pk %}" method="post">
      {% csrf_token %}
      {{ rating_form }}
      <input type="submit" value="Submit">
    </form>

  {% endif %}

{% endif %}

<h3>Reviews</h3>

<ul>
  {% for rating in movie.rating_set.all %}
  <li>
    {{ rating.score }} - {{ rating.content }} <b>by {{ rating.user.username }}</b>
    {% if user == rating.user %}
    <form action="{% url 'movies:ratings_delete' movie.pk rating.pk %}" method="post" style="display: inline-block;">
      {% csrf_token %}
      <input type="submit" value="Delete">
    </form>
    {% endif %}
  </li>
  {% endfor %}
</ul>

{% endblock %}
